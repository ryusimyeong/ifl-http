# 6. 캐시 무효화

### Cache-Control

확실한 캐시 무효화 응답

```
Cache-Control: no-cache, no-store, must-revalidate(이렇게 세 개 통째로 보냄)
Pragma: no-cache (HTTP 1.0 하위 호환)
```

별도로 캐시를 적용하지 않아도 웹브라우저가 임의로 캐시할 수 있음.

근데 절대 캐싱하면 안되는 페이지, 리소스는 위의 캐시 무효화 응답을 해줘야함.

> 예) 통장 잔고 등(매번 갱신되어야 함)

## 캐시 지시어 - 확실한 캐시 무효화

### no-cache

- 데이터 캐시해도 되는데 항상 원 서버에 검증(업데이트 됐는지 등)하고 사용

### no-store

- 데이터에 민감한 정보가 있으므로 저장하면 안됨
- 메모리에서 사용하고 최대한 빨리 삭제

### must-revalidate

- 캐시 만료 후 최초 조회 시 원 서버에 검증해야 함
- 원 서버 접근 실패 시 반드시 오류가 발생해야 함(504 Gateway Timeout)
- must-revalide는 캐시 유효시간이라면 캐시를 사용함

### Pragma: no-cache

- 1.0 하위 호환. 옛날 브라우저 등 폴리필

## no-cache 기본 동작

1. 캐시 서버 요청 no-cache+ETag
2. 프록시 서버에서 원서버로 전송
3. 원서버 검증
4. 원서버에서 프록시 캐시로 응답
5. 프록시 캐시에서 브라우저로 응답(304)
6. 브라우저 캐시로 저장

이때 프록시 캐시와 원 서버와의 네트워크가 단절되면

`no-cache` 인 경우, 프록시 캐시면 오류를 보내지 말고 오래된 데이터라도 보내게 설정 할 수 있음(Error or 200 OK)

근데 `must-revalidate`가 있으면 프록시가 원서버에 접근할 수 없으면 항상 오류가 발생됨. (504 Gateway Timeout).

돈과 같은 결과는 오류가 나서 안 보이는 게 더 낫다.
