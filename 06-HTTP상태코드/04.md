# 4. 3xx - 리다이렉션2

## 일시적 리다이렉션

302, 307, 303가 대표적

리소스의 uri가 일시적으로 변경, 따라서 검색 엔진 등에서 url을 변경하면 안된다.

### 302 found

- 리다이렉트 시 요청 메서드가 GET으로 변하고 본문이 제거될 수 있음(may)

### 307 temporary redirect

- 302와 기능은 같음
- 리다이렉트 시 요청 메서드와 본문 유지(요청 메서드를 변경하면 안된다. must not)

### 303 see other

- 302와 기능은 같음
- 리다이렉트 시 요청 메서드가 GET으로 변경(must)

뭔가 분명한 상황을 원하면 303과 307을 쓴다. 근데 대부분 302 씀

## PRG

일시적인 리다이렉션이 필요한 상황을 예를 들면,

`POST /orders -> 200 OK`

이 해당 uri에서 새로고침 한 번 더하면

POST 요청을 한 번 더 해서 주문이 한 번 더 된다.

이걸 막는 방법은

POST로 주문 후에 주문 결과 화면을 GET 메서드로 리다이렉트시켜 새로 고침으로 인한 클라 중복을 방지하는 것이다.

새로고침을 해도 결과 화면이 GET으로 조회되며

중복 주문 대신에 결과 화면만 GET으로 요청

정리하면

```
POST /orders
->
302 Found
Location: /order-result/19
->
자동 리다이렉트 GET /order-result/19
-> 200 OK. html 결과 화면만 줌
```

이 상태에서는 새로고침을 아무리 많이 해도 결과화면만 노출된다.

PRG 이후 리다이렉트

- URL이 이미 POST -> GET으로 리다이렉트됨
- 새로고침해도 GET으로 결과 화면만 조회

## PRG의 이점

- UX상으로도 좋고(불필요한 알림 안 써도 됨) 서버 에러도 줄어듦

## 정리

- 302 -> GET으로 변할 수 있음
- 307 -> 메서드로 변하면 안돼
- 303 -> 메서드가 GET으로 변해야 해

### 역사

처음 302 스펙의 의도는 HTTP 메소드를 유지하는 것이었다.

근데 웹 브라우저들이 대부분 GET으로 바꾸어 버렸고,

그래서 모호한 302를 대신하는 명화한 307, 303, 308 등 등장하게 되었다.

따라서 303, 307을 권장하지만 현실적으로 이미 많은 애플리케이션 라이브러리들이 302를 기본값으로 사용중이다.

자동 리다이렉션 시 GET으로 변해도 되면 그냥 302만 써도 큰 문제 없다.

## 기타 리다이렉션

300, 304

### 300 Multiple Choices

안 씀

### 304 Not Modified

많이 씀

- 캐시를 목적으로 사용
- 클라이언트에게 리소스가 수정되지 않았음을 알려줌 따라서 클라이언트는 로컬 pc에 저장된 캐시를 재사용한다. (캐시로 리다이렉트한다)
  - 클라: 나 캐시 있긴 한데 변경된 거 같으니까 서버야 다시 줘 -> 서버: 리소스 안 변경되었으니까 그냥 너 있는 거 써라
- 304 응답은 응답에 메세지 바디를 포함하면 안 된다. (로컬 캐시를 사용해야 하므로)
- 조건부 GET, HEAD 요청 시 사용
