# 5. 4xx - 클라이언트 오류, 5xx - 서버 오류

## 4xx client Error

클라이언트의 요청에 잘못된 문법 등 문제가 있어 서버가 요청을 수행할 수 없음

**즉, 오류의 원인이 클라이언트에 있음**

중요! 클라이언트가 이미 잘못된 요청, 데이터를 보내고 있기 때문에 **똑같은 재시도가 실패한다**. 즉 요청을 수정해야 함.

근데 5xx에러는 만약에 디비가 장애가 났다가 고쳐지면, **요청을 고치지 않아도 재시도가 성공할 수 있음**

### 400 Bad Request

클라가 잘못된 요청을 해서 서버가 요청을 처리할 수 없음.

요청 구문, 메세지 등 오류

클라는 요청 내용을 다시 검토

요청 파라미터가 잘못되거나 API스펙에 맞지 않을 때 발생

서버 개발자가 밸리데이션을 제대로 해놓지 않으면 500 에러로 발생할 수 있음. 이러면 안 됨.

서버 개발자는 최대한 정확하게 오류 메세지를 클라에게 보내줘야 한다.

### 401 Unauthorized

클라이언트가 해당 리소스에 대한 인증이 필요함

인증 Authentication 되지 않음

401 발생 시 응답에 WWW-Authenticate 헤더와 함께 인증 방법을 설명

#### 참고

인증(Authentication): 본인이 누구인지 확인. 예) 로그인

인가(Authorization): 권한부여. admin 권한처럼 특정 리소스에 접근할 수 있는 권한.

인증이 있어야 인가가 있음.

오류 메세지가 Unauthorized 이지만 `인증되지않음`. 이름이 아쉽다.

### 403 Forbidden

서버가 요청을 이해했지만 승인 거부

인증 자격 증명은 있지만 접근 권환이 불충분

- 예) 어드민 등급이 아닌 사용자가 로그인은 했지만 어드민 등급의 리소스에 접근하는 경우

### 404 Not Found

요청 리소스를 찾을 수 없음

요청 리소스가 서버에 없음. 주로 url 오타

또는 클라가 권한이 부족한 리소스에 접근할 때, 해당 리소스를 숨기고 싶을 때 사용한다. (403으로 하면 아 리소스가 있긴 하구나? 하는 정보를 줄 수 있음)

## 5xx server error

서버 오류

서버 문제로 오류 발생

서버에 문제가 있기 때문에 재시도하면 성공할 수도 잇음(db 복구 등등)

### 500 Internal Server Error

서버 문제로 오류 발생, 애매하면 500 오류

서버 내부 문제로 오류 발생

### 503 service unavailable

서비스 이용 불가

서버가 일시적인 과부하 또는 예정된 작업으로 잠시 요청을 처리할 수 없음

Retry-After 헤더 필드로 얼마뒤에 복구되는지 보낼 수 있음

근데 대부분 언제 복구될지 알기 어렵기 때문에 503은 거의 안쓰고 500 씀

## 정리

4xx은 클라오류. 인증이나 API 스펙을 못 맞췄거나, 오타냈거나

5xx은 서버오류. 웬만하면 5xx 에러는 발생하면 안 된다. 진짜 물리적으로 서버가 터졌을 때만 내야한다.

예를 들면

고객이 주문하는데 잔고가 부족하다.

그렇다고 500 에러를 내면 안된다.

이건 그냥 비즈니스 로직은 문제가 없는데 어떤 일시적인 처리니까 200이나 400으로 처리해야한다.

모니터링 툴 같은 걸 썼을 때 진짜 서버가 문제 있을 때만 골라내야 하는데 여기저기 500 에러 쓰면 진짜 문제를 찾아내기 어렵다.
