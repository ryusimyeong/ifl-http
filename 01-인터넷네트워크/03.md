# 3. TCP, UDP

## TCP

TCP는 IP의 문제점인 **비연결성, 비신뢰성, 패킷 구분없음**을 해결해준다.

### 인터넷 프로토콜 스택의 4계층

| 계층 | 계층이름          | 예시                              |
| ---- | ----------------- | --------------------------------- |
| 4    | 애플리케이션 계층 | HTTP, FTP, 애플리케이션, 브라우저 |
| 3    | 전송 계층         | TCP, UDP                          |
| 2    | 인터넷 계층       | IP                                |
| 1    | 네트워크 계층     | LAN, LAN드라이버                  |

TCP는 IP의 위 계층에서 IP를 보완해준다.

운영체제

내가 누군가에게 메세지를 보낸다면,

1. 애플리케이션 계층에서 프로그램이 메세지 생성

2. SOCKET 라이브러리를 통해 TCP로 전달

3. TCP 정보 생성, 메세지 데이터 포함, IP로 전달

4. IP 패킷 생성, TCP 데이터 포함 LAN카드로 전달

5. LAN카드를 이용해 인터넷을 통해 서버로 이동

순으로 작동한다.

즉 메세지에는 HTTP, TCP, IP, Ethernet frame이 씌워져있다.

IP 패킷정보에는 **출발지 IP, 목적기 IP** 등이 있다.

TCP 세그먼트에는 **출발지 PORT, 목적지 PORT, 전송제어, 순서, 검증 정보** 등이 있다.

### TCP 특징

전송제어프로토콜(Transmission Control Protocol)은 크게 아래 세 가지의 특징을 갖는다.

1. **연결지향(TCP 3 way handshake)**

- 클라이언트와 서버의 연결을 먼저 확인하고 데이터 전달

2. **데이터 전달 보증**

- 중간에 데이터가 누락이 되더라도 알 수 있음

3. **순서 보장**

따라서 TCP는 IP보다는 신뢰할 수 있는 프로토콜이며 현재는 대부분 TCP를 사용한다.

연결지향 TCP 3 way handshake

TCP는 3 way handshake 라는 방법을 사용해서 클라이언트와 서버의 연결 상태를 보장한다.

### 연결지향

1. 클라에서 서버로 `SYN`이라는 메세지를 보냄
2. 서버에서 클라로 `SYN` + `ACK`
3. 클라에서 서버로 `ACK`

> syn(syncronize)은 접속 요청, ack(acknowledge)은 요청 수락

위 과정처럼 3번에 걸쳐 연결상태를 확인한 후에 데이터를 전송한다.

요즘은 최적화가 많이 진행되어 3번의 과정 때 데이터를 함께 전송하기도 한다.

근데 이 연결은 **가상연결**이지 실제로 연결된 것은 아니다.

클라와 서버 사이에 있는 수많은 서버들, 노드들은 이 연결 사실을 모른다.

위 클라이언트와 서버를 위한 전용 LAN선이 보장되는 건 아니다.

### 데이터 전달 보증

클라이언트가 서버한테 데이터를 보내주면 서버가 클라한테 데이터를 잘 받았다고 응답해준다.

이 응답이 없으면 클라가 데이터가 제대로 가지 않았다는 것을 알 수 있다.

### 순서 보장

클라가 1, 2, 3 순서로 전송했는데

서버한테 1, 3, 2 순서로 도착하면

서버가 클라한테 2번부터 다시 보내라고 요청한다.

> 물론 서버에서 최적화 로직은 가능하다.

TCP가 이와 같이 연결성 뿐만 아니라 데이터, 순서를 보장할 수 있는 것은

전송제어, 순서, 검증정보가 있기 때문에 가능하다

## UDP

TCP와 같은 계층에 있지만 기능이 거의 없다.

IP와 거의 같음, PORT와 체크섬 정도만 추가되어 있고, 애플리케이션에서 추가 작업이 필요하다.

`PORT`는 하나의 IP에서 여러 애플리케이션을 위한 데이터 패킷을 받고, 구분할 수 있게 하는 것이고

`체크섬`은 데이터 검증하는 것이다.

`3 way handshake` 없고 데이터 전달 보증도 없고 순서 보장도 없다.

하지만 단순하고 빠르다.

UDP를 사용하는 이유는 개발자가 커스텀할 수 있기 때문이다.

TCP는 연결지향을 하기 위해서 속도가 느려진다.

또한 데이터 검증 등을 하면 데이터도 커지고 이미 관련 로직이 많아서 전송속도를 더 최적화하기 어렵다.

따라서 TCP는 개발자가 따로 손을 댈 수가 없다.

반면 UDP는 애플리케이션 레벨에서 내가 최적화를 할 수 있다.

최근에는 데이터 전송을 최적화하기 위해 UDP가 각광받고 있다.
