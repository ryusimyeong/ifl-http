# 4. HTTP 메서드의 속성

HTTP 메서드의 속성으로는 크게 세 가지가 있다.

- 안전 safe methods
- 멱등 idempotent methods
- 캐시가능 cacheable methods

### 안전

리소스를 변경하지 않는다.

- `GET` 안전
- `POST`, `PUT`, `PATCH`, `DELETE` 안전하지 않음

그래도 계속 호출해서 로그 같은 게 쌓여서 장애가 발생하면?

안전은 리소스만 고려함. 그런 건 고려하지 않는다.

### 멱등

같은 요청을 한 번 호출하든 두 번 호출하든 백 번 호출하든 결과가 똑같으면 멱등

- GET: 계속 조회해봤자 리소스 안 변함. 멱등
- PUT: 결과를 대체한다. 따라서 같은 요청을 여러번해도 최종결과는 같다. 멱등
- DELETE: 결과를 삭제한다. 같은 요청을 여러번 해도 삭제된 결과는 같다. 멱등

POST 멱등 아님. 두 번 호출하면 같은 결제가 중복해서 발생 가능.

멱등이라는 개념은 왜 있는 걸까?

자동복구 메커니즘. 서버가 타임아웃등으로 정상 응답을 못줬을 때 클라이언트가 같은 요청을 다시해도 되는가? 의 판단 근거가 된다.

즉 GET, PUT, DELETE 등은 다시 요청해도 된다.

재요청 중간에 다른 곳에서 리소스를 변경해버리면? 외부요인으로 중간에 리소스가 변경되는 것까지는 멱등 여부를 판단하는 데 고려하지 않는다.

#### PATCH의 경우

`PATCH`는 설계에 따라 멱등이기도 하고 아니기도 한다.

예를 들어

아래와 같이 name을 "kim"으로 바꾸기만 하는 경우 PATCH 이지만 멱등이다

```
{ name: "kim" }
```

반면에 operation이라는 key값이 "add"일 때, "age"의 값만큼 더해주는 API를 PATCH로 설계하면 이는 멱등이 아니다.

```
{ "operation": "add", "age": 10"}
```

정리하면 PATCH는 리소스의 특정 부분을 변경하는데, 이 변경 방식이 멱등이어도 되고, 멱등이 아니어도 된다.

### 캐시가능

응답 결과 리소스를 캐시해서 사용해도 되는가? 에 관한 속성

GET, HEAD, POST, PATCH 캐시 가능

실제로는 GET, HEAD정도만 캐시로 사용한다.

POST, PATCH는 본문 내용까지 캐시 키로 고려해야 하는데, 구현이 쉽지 않다.
